/*
In this file we have created the ddl commands to create the tables coming from crm source as well as the erp source
A tip while loading the data to these tables is that sometimes if you are a mac user the 'Import Wizard' feature might not load certain files
so make sure to use 'infile Load' feature in order to load the data

I have also created a procedure which can be saved for future loads as it will be called using simple query:-
EXEC bronze_load;

*/





create or alter procedure bronze.load_bronze as
begin

create table bronze.crm_prd_sales_details(
sls_ord_num nvarchar(100),
sls_prd_key nvarchar(100),
sls_cust_id int,
sls_order_dt int,
sls_ship_dt int,
sls_due_dt int,
sls_sales int,
sls_quantity int,
sls_price int
);
create table bronze.erp_loc_a101(
cid nvarchar(100),
cntry nvarchar(100)
);
create table bronze.erp_cust_az12(
cid nvarchar(100),
bdate date,
gen nvarchar(50)
);
create table bronze.erp_px_cat_g1v2(
id nvarchar(50),
cat nvarchar(50),
subcat nvarchar(50),
maintainence nvarchar(50)
);
select * from bronze.crm_prd_info;
select * from bronze.crm_prd_sales_details;
select * from bronze.erp_cust_az12;
select * from bronze.erp_loc_a101;
select * from bronze.erp_px_cat_g1v2;

create table bronze.crm_cust_info(
cst_id int,
cst_key nvarchar(50),
cst_firstname nvarchar(50),
cst_lastname nvarchar(50),
cst_material_status nvarchar(50),
cst_gndr nvarchar(50),
cst_create_date date
);
LOAD DATA LOCAL INFILE 'Desktop/sql-data-warehouse-project/datasets/source_crm/cust_info.csv'
INTO TABLE bronze.cust_info
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;

ALTER TABLE bronze.crm_cust_info
CONVERT TO CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;
SET GLOBAL local_infile = 1;

LOAD DATA LOCAL INFILE '/Users/shitijchauhan/Desktop/sql-data-warehouse-project/datasets/source_crm/cust_info.csv'
INTO TABLE bronze.crm_cust_info
CHARACTER SET utf8mb4
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
END
